
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BodyBeat V5.0 - Virtual Trainer (Arms)</title>

<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial, sans-serif; }
video { display:none; }
canvas { position:absolute; width:100%; height:100%; }

#overlay {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background:black; color:white; display:flex;
  align-items:center; justify-content:center;
  font-size:22px; z-index:10;
}

#modeLabel {
  position:absolute;
  top:15px;
  left:50%;
  transform:translateX(-50%);
  color:#00ffcc;
  font-size:18px;
  z-index:5;
}
</style>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

</head>
<body>

<div id="overlay">Toca para activar c√°mara</div>
<div id="modeLabel">Modo Entrenador - Brazos</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

<script>

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const overlay = document.getElementById("overlay");

overlay.onclick = async () => {
  overlay.style.display = "none";
  await startPose();
};

async function startPose(){

  const stream = await navigator.mediaDevices.getUserMedia({
    video:{ facingMode:"user" }
  });

  video.srcObject = stream;

  video.onloadeddata = () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
  };

  const pose = new Pose({
    locateFile: (file) => {
      return `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`;
    }
  });

  pose.setOptions({
    modelComplexity: 1,
    smoothLandmarks: true,
    minDetectionConfidence: 0.5,
    minTrackingConfidence: 0.5
  });

  pose.onResults(onResults);

  const camera = new Camera(video, {
    onFrame: async () => {
      await pose.send({image: video});
    },
    width: 640,
    height: 480
  });

  camera.start();
}

function drawLine(a,b,color,width=4){
  ctx.strokeStyle=color;
  ctx.lineWidth=width;
  ctx.beginPath();
  ctx.moveTo(a.x*canvas.width, a.y*canvas.height);
  ctx.lineTo(b.x*canvas.width, b.y*canvas.height);
  ctx.stroke();
}

function drawCircle(p,color){
  ctx.fillStyle=color;
  ctx.beginPath();
  ctx.arc(p.x*canvas.width, p.y*canvas.height, 6, 0, 2*Math.PI);
  ctx.fill();
}

function drawTrainerSilhouette(){
  const cx = canvas.width/2;
  const cy = canvas.height/2;

  ctx.strokeStyle = "rgba(0,255,255,0.4)";
  ctx.lineWidth = 6;

  // Brazos en guardia
  ctx.beginPath();
  ctx.moveTo(cx-120, cy-40);
  ctx.lineTo(cx-60, cy-120);
  ctx.lineTo(cx-20, cy-60);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(cx+120, cy-40);
  ctx.lineTo(cx+60, cy-120);
  ctx.lineTo(cx+20, cy-60);
  ctx.stroke();
}

function onResults(results){

  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.drawImage(results.image,0,0,canvas.width,canvas.height);

  drawTrainerSilhouette();

  if(results.poseLandmarks){

    const lm = results.poseLandmarks;

    const leftShoulder = lm[11];
    const leftElbow = lm[13];
    const leftWrist = lm[15];

    const rightShoulder = lm[12];
    const rightElbow = lm[14];
    const rightWrist = lm[16];

    // Dibujar brazos usuario
    drawLine(leftShoulder,leftElbow,"#00ff00");
    drawLine(leftElbow,leftWrist,"#00ff00");

    drawLine(rightShoulder,rightElbow,"#00ff00");
    drawLine(rightElbow,rightWrist,"#00ff00");

    drawCircle(leftWrist,"#00ff00");
    drawCircle(rightWrist,"#00ff00");
  }
}

</script>

</body>
</html>
