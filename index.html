
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BodyBeat V5.3 - Trainer Arms LiveStream</title>

<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial, sans-serif; }
video { display:none; }
canvas { position:absolute; width:100%; height:100%; }

#overlay {
  position:absolute; top:0; left:0; width:100%; height:100%;
  background:black; color:white; display:flex;
  align-items:center; justify-content:center;
  font-size:22px; z-index:10; cursor:pointer;
}

#label {
  position:absolute;
  top:15px;
  left:50%;
  transform:translateX(-50%);
  color:#00ffcc;
  font-size:18px;
}
</style>

<script type="module">
import { PoseLandmarker, FilesetResolver } 
from "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3";

let poseLandmarker;
let video, canvas, ctx;
let currentLandmarks = null;

async function initPose(){

  const vision = await FilesetResolver.forVisionTasks(
    "https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.3/wasm"
  );

  poseLandmarker = await PoseLandmarker.createFromOptions(vision, {
    baseOptions: {
      modelAssetPath: "https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/latest/pose_landmarker_lite.task"
    },
    runningMode: "LIVE_STREAM",
    numPoses: 1,
    resultCallback: (result) => {
      if (result.landmarks && result.landmarks.length > 0) {
        currentLandmarks = result.landmarks[0];
      }
    }
  });

  const stream = await navigator.mediaDevices.getUserMedia({
    video: { facingMode: "user" }
  });

  video.srcObject = stream;

  video.onloadeddata = () => {
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    renderLoop();
  };
}

function drawLine(a,b,color){
  ctx.strokeStyle=color;
  ctx.lineWidth=4;
  ctx.beginPath();
  ctx.moveTo(a.x*canvas.width, a.y*canvas.height);
  ctx.lineTo(b.x*canvas.width, b.y*canvas.height);
  ctx.stroke();
}

function drawTrainerSilhouette(){
  const cx = canvas.width/2;
  const cy = canvas.height/2;

  ctx.strokeStyle = "rgba(0,255,255,0.4)";
  ctx.lineWidth = 6;

  ctx.beginPath();
  ctx.moveTo(cx-120, cy-40);
  ctx.lineTo(cx-60, cy-120);
  ctx.lineTo(cx-20, cy-60);
  ctx.stroke();

  ctx.beginPath();
  ctx.moveTo(cx+120, cy-40);
  ctx.lineTo(cx+60, cy-120);
  ctx.lineTo(cx+20, cy-60);
  ctx.stroke();
}

function renderLoop(){

  ctx.drawImage(video,0,0,canvas.width,canvas.height);

  if (poseLandmarker) {
    poseLandmarker.detectAsync(video, performance.now());
  }

  drawTrainerSilhouette();

  if(currentLandmarks){
    const lm = currentLandmarks;

    const leftShoulder = lm[11];
    const leftElbow = lm[13];
    const leftWrist = lm[15];

    const rightShoulder = lm[12];
    const rightElbow = lm[14];
    const rightWrist = lm[16];

    drawLine(leftShoulder,leftElbow,"#00ff00");
    drawLine(leftElbow,leftWrist,"#00ff00");

    drawLine(rightShoulder,rightElbow,"#00ff00");
    drawLine(rightElbow,rightWrist,"#00ff00");
  }

  requestAnimationFrame(renderLoop);
}

window.addEventListener("DOMContentLoaded", () => {
  video = document.getElementById("video");
  canvas = document.getElementById("canvas");
  ctx = canvas.getContext("2d");

  const overlay = document.getElementById("overlay");
  overlay.onclick = () => {
    overlay.style.display="none";
    initPose();
  };
});

</script>

</head>
<body>

<div id="overlay">Toca para iniciar entrenador</div>
<div id="label">Modo Entrenador - Brazos (V5.3 LIVE)</div>

<video id="video" autoplay playsinline></video>
<canvas id="canvas"></canvas>

</body>
</html>
